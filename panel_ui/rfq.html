<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RFQ Panel</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Heroicons -->
    <script src="https://unpkg.com/heroicons@2.0.16/dist/heroicons.js"></script>
</head>

<body class="bg-gray-100 text-gray-900">

    <main class="p-10 max-w-5xl mx-auto">

        <h1 class="text-4xl font-bold mb-8 text-center">RFQ Dashboard</h1>

        <!-- RFQ TABLE -->
        <div class="bg-white p-6 rounded shadow-lg">
            <h2 class="text-xl font-semibold mb-4">Recent RFQs</h2>

            <table class="min-w-full text-sm text-left">
                <thead>
                    <tr class="border-b">
                        <th class="py-2">RFQ ID</th>
                        <th>Status</th>
                        <th>Delay</th>
                        <th>Value</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody id="rfqTable"></tbody>
            </table>
        </div>

    </main>

    <!-- JS LOGIC -->
    <script>

        // SAMPLE RFQ DATA (static for Phase-5)
        const rfqList = [
            { id: "RFQ-101", status: "open", vendor_delay_days: 1, value: 50000 },
            { id: "RFQ-102", status: "pending", vendor_delay_days: 3, value: 80000 },
            { id: "RFQ-103", status: "quotation_received", vendor_delay_days: 0, value: 120000 },
            { id: "RFQ-104", status: "pending", vendor_delay_days: 4, value: 250000 },
        ];


        function renderRFQs() {
            const table = document.getElementById("rfqTable");
            table.innerHTML = "";

            rfqList.forEach(rfq => {

                const delayColor =
                    rfq.vendor_delay_days >= 3 ? "text-red-600" :
                    rfq.vendor_delay_days === 2 ? "text-yellow-600" :
                    "text-green-600";

                const statusBadge =
                    rfq.status === "quotation_received"
                        ? "bg-green-100 text-green-700"
                        : "bg-blue-100 text-blue-700";

                const tr = document.createElement("tr");
                tr.className = "border-b";

                tr.innerHTML = `
                    <td class="py-2 font-medium">${rfq.id}</td>

                    <td>
                        <span class="px-3 py-1 rounded ${statusBadge}">
                            ${rfq.status}
                        </span>
                    </td>

                    <td class="${delayColor}">
                        ${rfq.vendor_delay_days} days
                    </td>

                    <td>â‚¹ ${rfq.value.toLocaleString()}</td>

                    <td>
                        <button class="px-4 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"
                                onclick='runAutopilot(${JSON.stringify(rfq)})'>
                            Run
                        </button>
                    </td>
                `;

                table.appendChild(tr);
            });
        }


        function runAutopilot(rfqObj) {
            fetch("http://127.0.0.1:8080/suggest_action", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    parsed_email: { category: "quotation" },
                    rfq_data: rfqObj
                })
            })
                .then(res => res.json())
                .then(data => {
                    alert(
                        "RFQ: " + rfqObj.id +
                        "\n\nAction: " + data.action +
                        "\nReason: " + data.reason
                    );
                })
                .catch(err => {
                    alert("Error: " + err);
                });
        }

        renderRFQs();
    </script>

</body>
</html>
